/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package simperkas;

import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import kelas.User;

public class panelUser extends javax.swing.JPanel {

    /**
     * Creates new form panelUser
     */
    public panelUser() {
        initComponents();
        load_table();
        reset();
    }

    void reset() {
        tUsername.setText("");
        tPassword.setText("");
        tFullName.setText("");
        cbStatus.setSelectedIndex(0);
        tUsername.setEditable(true);
    }

    void load_table() {
        DefaultTableModel model = new DefaultTableModel();
        model.addColumn("Username");
        model.addColumn("Full Name");
        model.addColumn("Status");

        try {
            User usr = new User();
            ResultSet rs = usr.tampilUser();

            while (rs.next()) {
                model.addRow(new Object[]{
                    rs.getString("userName"),
                    rs.getString("userFullName"),
                    rs.getInt("userStatus") == 1 ? "Active" : "Inactive"
                });
            }
            tbUser.setModel(model);
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(this, "Gagal memuat data: " + e.getMessage());
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lPassword = new javax.swing.JLabel();
        tPassword = new javax.swing.JTextField();
        lStatus = new javax.swing.JLabel();
        tUsername = new javax.swing.JTextField();
        cbStatus = new javax.swing.JComboBox<>();
        lUsername = new javax.swing.JLabel();
        tFullName = new javax.swing.JTextField();
        lFullName = new javax.swing.JLabel();
        bTambah = new javax.swing.JButton();
        bReset = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        tbUser = new javax.swing.JTable();
        bHapus = new javax.swing.JButton();
        bUbah = new javax.swing.JButton();
        Bguser = new javax.swing.JLabel();

        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lPassword.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        lPassword.setText("Password");
        add(lPassword, new org.netbeans.lib.awtextra.AbsoluteConstraints(450, 180, -1, -1));

        tPassword.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        tPassword.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                tPasswordActionPerformed(evt);
            }
        });
        add(tPassword, new org.netbeans.lib.awtextra.AbsoluteConstraints(450, 200, 330, -1));

        lStatus.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        lStatus.setText("Status          ");
        add(lStatus, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 180, -1, -1));

        tUsername.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        add(tUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 140, 330, -1));

        cbStatus.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Active", "Inactive" }));
        cbStatus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbStatusActionPerformed(evt);
            }
        });
        add(cbStatus, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 200, 330, -1));

        lUsername.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        lUsername.setText("Username    ");
        add(lUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 120, -1, -1));

        tFullName.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        add(tFullName, new org.netbeans.lib.awtextra.AbsoluteConstraints(450, 140, 330, -1));

        lFullName.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        lFullName.setText("Full Name    ");
        add(lFullName, new org.netbeans.lib.awtextra.AbsoluteConstraints(450, 120, -1, -1));

        bTambah.setBackground(new java.awt.Color(0, 51, 153));
        bTambah.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        bTambah.setForeground(new java.awt.Color(255, 255, 255));
        bTambah.setText("Tambah");
        bTambah.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bTambahActionPerformed(evt);
            }
        });
        add(bTambah, new org.netbeans.lib.awtextra.AbsoluteConstraints(230, 240, 130, -1));

        bReset.setBackground(new java.awt.Color(0, 51, 153));
        bReset.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        bReset.setForeground(new java.awt.Color(255, 255, 255));
        bReset.setText("Reset");
        bReset.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bResetActionPerformed(evt);
            }
        });
        add(bReset, new org.netbeans.lib.awtextra.AbsoluteConstraints(650, 240, 130, -1));

        tbUser.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tbUser.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tbUserMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tbUser);

        add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(40, 280, 740, 260));

        bHapus.setBackground(new java.awt.Color(204, 0, 51));
        bHapus.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        bHapus.setForeground(new java.awt.Color(255, 255, 255));
        bHapus.setText("Hapus");
        bHapus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bHapusActionPerformed(evt);
            }
        });
        add(bHapus, new org.netbeans.lib.awtextra.AbsoluteConstraints(510, 240, 130, -1));

        bUbah.setBackground(new java.awt.Color(0, 51, 153));
        bUbah.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        bUbah.setForeground(new java.awt.Color(255, 255, 255));
        bUbah.setText("Ubah");
        bUbah.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bUbahActionPerformed(evt);
            }
        });
        add(bUbah, new org.netbeans.lib.awtextra.AbsoluteConstraints(370, 240, 130, -1));

        Bguser.setIcon(new javax.swing.ImageIcon(getClass().getResource("/pict/Panel Transaksi.png"))); // NOI18N
        add(Bguser, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 820, 600));
    }// </editor-fold>//GEN-END:initComponents

    private void tPasswordActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_tPasswordActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_tPasswordActionPerformed

    private void cbStatusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbStatusActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cbStatusActionPerformed

    private void bResetActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bResetActionPerformed
        tUsername.setText(null);
        tPassword.setText(null);
        tFullName.setText(null);
        cbStatus.setSelectedIndex(0);
    }//GEN-LAST:event_bResetActionPerformed

    private void bTambahActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bTambahActionPerformed
        if (tUsername.getText().isEmpty()
                || tPassword.getText().isEmpty()
                || tFullName.getText().isEmpty()) {

            JOptionPane.showMessageDialog(this,
                    "Semua field harus diisi!",
                    "Peringatan",
                    JOptionPane.WARNING_MESSAGE);
            return;
        }

        try {
            User usr = new User();
            usr.setUserName(tUsername.getText());
            usr.setUserPassword(tPassword.getText());
            usr.setUserFullName(tFullName.getText());
            usr.setUserStatus(cbStatus.getSelectedIndex() == 0 ? 1 : 0);

            usr.tambahUser();
            load_table();
            reset();
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Gagal menambahkan data: " + e.getMessage());
        }
    }//GEN-LAST:event_bTambahActionPerformed

    private void bHapusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bHapusActionPerformed
        String username = tUsername.getText().trim();

        if (username.isEmpty()) {
            JOptionPane.showMessageDialog(null, "Pilih user yang ingin dihapus!", "Peringatan", JOptionPane.WARNING_MESSAGE);
            return;
        }

        int confirm = JOptionPane.showConfirmDialog(
                null,
                "Apakah Anda yakin ingin menghapus user ini? \"" + username + "\"?",
                "Konfirmasi Hapus",
                JOptionPane.YES_NO_OPTION
        );

        if (confirm == JOptionPane.YES_OPTION) {
            try {
                User usr = new User();
                usr.setUserName(username);
                usr.hapusUser();
                JOptionPane.showMessageDialog(null, "User berhasil dihapus!");
                reset();
                load_table();
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Gagal menghapus user!");
            }
        }
    }//GEN-LAST:event_bHapusActionPerformed

    private void bUbahActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bUbahActionPerformed

        if (tUsername.getText().isEmpty() || tFullName.getText().isEmpty()) {
            JOptionPane.showMessageDialog(null, "Semua field harus diisi!", "Peringatan", JOptionPane.WARNING_MESSAGE);
            return;
        }

        try {
            User usr = new User();
            usr.setUserName(tUsername.getText());
            usr.setUserFullName(tFullName.getText());
            usr.setUserStatus(cbStatus.getSelectedIndex() == 0 ? 1 : 0);
            if (!tPassword.getText().trim().isEmpty()) {
                usr.setUserPassword(tPassword.getText());
            }
            usr.ubahUser();
            JOptionPane.showMessageDialog(this, "Data berhail diubah!");
            load_table();
            reset();
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Gagal mengubah data!");
        }
    }//GEN-LAST:event_bUbahActionPerformed

    private void tbUserMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tbUserMouseClicked
        int row = tbUser.getSelectedRow();
        tUsername.setText(tbUser.getValueAt(row, 0).toString());
        tFullName.setText(tbUser.getValueAt(row, 1).toString());
        cbStatus.setSelectedItem(tbUser.getValueAt(row, 2).toString());
        tUsername.setEditable(false);
    }//GEN-LAST:event_tbUserMouseClicked


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel Bguser;
    private javax.swing.JButton bHapus;
    private javax.swing.JButton bReset;
    private javax.swing.JButton bTambah;
    private javax.swing.JButton bUbah;
    private javax.swing.JComboBox<String> cbStatus;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lFullName;
    private javax.swing.JLabel lPassword;
    private javax.swing.JLabel lStatus;
    private javax.swing.JLabel lUsername;
    private javax.swing.JTextField tFullName;
    private javax.swing.JTextField tPassword;
    private javax.swing.JTextField tUsername;
    private javax.swing.JTable tbUser;
    // End of variables declaration//GEN-END:variables
}
